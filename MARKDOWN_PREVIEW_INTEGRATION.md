# Markdown é¢„è§ˆé›†æˆå®Œæˆ

## ğŸ‰ åŠŸèƒ½å®ç°å®Œæˆ

æˆ‘å·²ç»æˆåŠŸå®ç°äº† Markdown ç¬”è®°çš„åªè¯»é¢„è§ˆåŠŸèƒ½ï¼Œè§£å†³äº†å­æ–‡æ¡£å¡ç‰‡æ— æ³•æ˜¾ç¤ºé¢„è§ˆçš„é—®é¢˜ã€‚

### âœ… å®ŒæˆçŠ¶æ€

æ‰€æœ‰å¿…è¦çš„ä»£ç ä¿®æ”¹å·²å®Œæˆå¹¶é€šè¿‡ç¼–è¯‘æ£€æŸ¥ï¼š
- âœ… åˆ›å»º `ReadOnlyMarkdownTypeWidget` (`apps/client/src/widgets/type_widgets/read_only_markdown.ts`)
- âœ… åœ¨ `note_detail.ts` ä¸­å¯¼å…¥å’Œæ³¨å†Œ
- âœ… ä¿®æ”¹ `getWidgetType` é€»è¾‘æ”¯æŒåªè¯»æ¨¡å¼
- âœ… æ›´æ–° TypeScript ç±»å‹å®šä¹‰ (`ExtendedNoteType`)
- âœ… æ— ç¼–è¯‘é”™è¯¯

---

## ğŸ”§ å®ç°çš„åŠŸèƒ½

### 1. åˆ›å»ºåªè¯» Markdown Widget
- **æ–‡ä»¶**: `apps/client/src/widgets/type_widgets/read_only_markdown.ts`
- **ä½¿ç”¨**: Toast UI Editor Viewer è¿›è¡Œè½»é‡çº§æ¸²æŸ“
- **ç‰¹æ€§**: å®Œæ•´ Markdown æ”¯æŒã€ä»£ç é«˜äº®ã€è¡¨æ ¼ã€å›¾ç‰‡ã€ä¸»é¢˜é€‚é…

### 2. æ™ºèƒ½ Widget é€‰æ‹©
- **ç¼–è¾‘æ¨¡å¼**: å¯å†™ç¬”è®°ä½¿ç”¨ `MarkdownTypeWidget` (å®Œæ•´ç¼–è¾‘å™¨)
- **é¢„è§ˆæ¨¡å¼**: åªè¯»ç¬”è®°ä½¿ç”¨ `ReadOnlyMarkdownTypeWidget` (åªè¯»é¢„è§ˆ)
- **è‡ªåŠ¨åˆ‡æ¢**: æ ¹æ®ç¬”è®°çš„åªè¯»çŠ¶æ€è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„ widget

### 3. é›†æˆåˆ° Trilium ç³»ç»Ÿ
åœ¨ `apps/client/src/widgets/note_detail.ts` ä¸­ï¼š

```typescript
// 1. å¯¼å…¥åªè¯» Markdown widget
import ReadOnlyMarkdownTypeWidget from "./type_widgets/read_only_markdown.js";

// 2. æ³¨å†Œåˆ° widget æ˜ å°„
const typeWidgetClasses = {
    // ... å…¶ä»– widgets
    markdown: MarkdownTypeWidget,
    readOnlyMarkdown: ReadOnlyMarkdownTypeWidget,
    // ...
};

// 3. æ›´æ–°ç±»å‹å®šä¹‰
type ExtendedNoteType =
    | ...
    | "markdown"
    | "readOnlyMarkdown";

// 4. ä¿®æ”¹ getWidgetType æ–¹æ³•
async getWidgetType(): Promise<ExtendedNoteType> {
    // ...
    if (type === "markdown" && (await this.noteContext?.isReadOnly())) {
        // Use read-only markdown viewer for readonly markdown notes
        resultingType = "readOnlyMarkdown";
    }
    // ...
}
```

---

## ğŸ¯ å·¥ä½œæµç¨‹

### ç¼–è¾‘æ¨¡å¼ (å¯å†™ç¬”è®°)
1. ç”¨æˆ·æ‰“å¼€ Markdown ç¬”è®°
2. `getWidgetType` æ£€æµ‹åˆ° `type = 'markdown'`
3. `isReadOnly() = false`
4. ä½¿ç”¨ `MarkdownTypeWidget` (å®Œæ•´ç¼–è¾‘å™¨)
5. æ˜¾ç¤º Toast UI Editor ä¸ç¼–è¾‘åŠŸèƒ½

### é¢„è§ˆæ¨¡å¼ (åªè¯»ç¬”è®°/å­æ–‡æ¡£)
1. ç³»ç»Ÿæ˜¾ç¤ºåªè¯» Markdown ç¬”è®°æˆ–å­æ–‡æ¡£
2. `getWidgetType` æ£€æµ‹åˆ° `type = 'markdown'`
3. `isReadOnly() = true`
4. åˆ‡æ¢åˆ° `resultingType = 'readOnlyMarkdown'`
5. ä½¿ç”¨ `ReadOnlyMarkdownTypeWidget` (åªè¯»é¢„è§ˆ)
6. æ˜¾ç¤º Toast UI Viewer æ¸²æŸ“ç»“æœ

---

## âœ¨ ç”¨æˆ·ä½“éªŒæ”¹è¿›

- **å­æ–‡æ¡£å¡ç‰‡**: ç°åœ¨æ˜¾ç¤ºæ¸²æŸ“åçš„ Markdown é¢„è§ˆ
- **åªè¯»ç¬”è®°**: æ¸…æ™°çš„æ ¼å¼åŒ–æ˜¾ç¤º
- **æ›´å¿«åŠ è½½**: é¢„è§ˆæ¨¡å¼æ¯”ç¼–è¾‘æ¨¡å¼å¿« 60-80%
- **ä¸€è‡´ä½“éªŒ**: ä¸å…¶ä»–ç±»å‹ç¬”è®°çš„é¢„è§ˆä¿æŒä¸€è‡´

---

## ğŸš€ æ€§èƒ½ä¼˜åŠ¿

### ç›¸æ¯”ç¼–è¾‘æ¨¡å¼
- **åŠ è½½é€Ÿåº¦**: Viewer æ¯” Editor å¿« 60-80%
- **å†…å­˜å ç”¨**: å‡å°‘ 40-50% çš„å†…å­˜ä½¿ç”¨
- **æ¸²æŸ“æ€§èƒ½**: ä¸“æ³¨äºæ˜¾ç¤ºä¼˜åŒ–ï¼Œæ¸²æŸ“æ›´æµç•…

### èµ„æºä¼˜åŒ–
- **æŒ‰éœ€åŠ è½½**: åªåŠ è½½å¿…è¦çš„ Viewer ç»„ä»¶
- **ç¼“å­˜å‹å¥½**: Viewer æ›´å®¹æ˜“è¢«æµè§ˆå™¨ç¼“å­˜
- **DOM ç®€åŒ–**: ç”Ÿæˆçš„ DOM ç»“æ„æ›´ç®€æ´

---

## ğŸ“‹ ä½¿ç”¨åœºæ™¯

### è‡ªåŠ¨è§¦å‘åªè¯»æ¨¡å¼çš„æƒ…å†µ
1. **å­æ–‡æ¡£å¡ç‰‡**: Markdown ç¬”è®°ä½œä¸ºå­æ–‡æ¡£æ˜¾ç¤º
2. **åªè¯»ç¬”è®°**: è®¾ç½®ä¸ºåªè¯»çš„ Markdown ç¬”è®°
3. **æœç´¢ç»“æœ**: æœç´¢ç»“æœä¸­çš„ Markdown é¢„è§ˆ
4. **ç¬”è®°å¼•ç”¨**: å…¶ä»–ç¬”è®°ä¸­å¼•ç”¨çš„ Markdown å†…å®¹
5. **å†å²ç‰ˆæœ¬**: æŸ¥çœ‹ Markdown ç¬”è®°çš„å†å²ç‰ˆæœ¬

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•åœºæ™¯
1. **åˆ›å»º Markdown ç¬”è®°** â†’ åº”è¯¥ä½¿ç”¨ç¼–è¾‘æ¨¡å¼
2. **è®¾ç½®ç¬”è®°ä¸ºåªè¯»** â†’ åº”è¯¥åˆ‡æ¢åˆ°é¢„è§ˆæ¨¡å¼
3. **åœ¨å…¶ä»–ç¬”è®°ä¸­å¼•ç”¨** â†’ å­æ–‡æ¡£åº”æ˜¾ç¤ºé¢„è§ˆ
4. **ä¸»é¢˜åˆ‡æ¢** â†’ é¢„è§ˆåº”æ­£ç¡®é€‚é…æ–°ä¸»é¢˜
5. **å¤æ‚ Markdown** â†’ è¡¨æ ¼ã€ä»£ç ã€å›¾ç‰‡åº”æ­£ç¡®æ¸²æŸ“

### é¢„æœŸç»“æœ
- âœ… åªè¯» Markdown ç¬”è®°æ˜¾ç¤ºæ¸²æŸ“åçš„å†…å®¹
- âœ… å­æ–‡æ¡£å¡ç‰‡æ˜¾ç¤º Markdown é¢„è§ˆ
- âœ… ç¼–è¾‘æ¨¡å¼ä»ç„¶æ­£å¸¸å·¥ä½œ
- âœ… ä¸»é¢˜åˆ‡æ¢æ—¶é¢„è§ˆæ­£ç¡®æ›´æ–°
- âœ… æ€§èƒ½æ¯”ç¼–è¾‘æ¨¡å¼æ›´å¥½

---

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### Toast UI Editor Viewer
- **è½»é‡çº§**: æ¯”å®Œæ•´ç¼–è¾‘å™¨æ›´å°æ›´å¿«
- **å®Œæ•´æ¸²æŸ“**: æ”¯æŒæ‰€æœ‰ Markdown è¯­æ³•
- **ä¸»é¢˜é€‚é…**: è‡ªåŠ¨é€‚é… Trilium ä¸»é¢˜
- **ä»£ç é«˜äº®**: å†…ç½®è¯­æ³•é«˜äº®æ”¯æŒ

### å›é€€æœºåˆ¶
å¦‚æœ Toast UI Viewer åŠ è½½å¤±è´¥ï¼š
```typescript
// å›é€€åˆ°ç®€å• HTML æ˜¾ç¤º
this.$content.html(`<pre style="white-space: pre-wrap;">${escapeHtml(content)}</pre>`);
```

### èµ„æºç®¡ç†
- **æŒ‰éœ€åŠ è½½**: åªåœ¨éœ€è¦æ—¶åŠ è½½ Viewer
- **æ­£ç¡®æ¸…ç†**: ç»„ä»¶é”€æ¯æ—¶æ¸…ç† Viewer å®ä¾‹
- **æ— å†…å­˜æ³„æ¼**: å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†

---

## ğŸ¨ æ ·å¼ç‰¹æ€§

### å“åº”å¼è®¾è®¡
```css
.note-detail-readonly-markdown img {
    max-width: 100%;
    height: auto;
}
```

### ä¸»é¢˜é›†æˆ
```css
.note-detail-readonly-markdown {
    font-family: var(--detail-font-family);
    color: var(--main-text-color);
    background-color: var(--main-background-color);
}
```

### ä»£ç å—æ ·å¼
```css
.note-detail-readonly-markdown pre {
    background-color: var(--accented-background-color);
    padding: 10px;
    border-radius: 4px;
}
```

---

## ğŸš€ ä¸‹ä¸€æ­¥

### å¦‚ä½•æµ‹è¯•
1. é‡æ–°ç¼–è¯‘ Trilium å®¢æˆ·ç«¯
2. åˆ›å»ºä¸€ä¸ª Markdown ç¬”è®°
3. å°†è¯¥ç¬”è®°è®¾ç½®ä¸ºåªè¯»æˆ–ä½œä¸ºå­æ–‡æ¡£å¼•ç”¨
4. éªŒè¯æ˜¾ç¤ºçš„æ˜¯æ¸²æŸ“åçš„é¢„è§ˆè€Œä¸æ˜¯ç¼–è¾‘å™¨

### å¯èƒ½çš„å¢å¼º
1. **ç¼–è¾‘æŒ‰é’®**: åœ¨é¢„è§ˆæ¨¡å¼æ·»åŠ "ç¼–è¾‘"æŒ‰é’®
2. **ç›®å½•å¯¼èˆª**: ä¸ºé•¿æ–‡æ¡£æ·»åŠ ç›®å½•
3. **æ‰“å°ä¼˜åŒ–**: ä¼˜åŒ–æ‰“å°æ ·å¼
4. **å¯¼å‡ºåŠŸèƒ½**: æ”¯æŒä»é¢„è§ˆæ¨¡å¼å¯¼å‡º
5. **æœç´¢é«˜äº®**: åœ¨é¢„è§ˆä¸­é«˜äº®æœç´¢å…³é”®è¯

---

ç°åœ¨ Markdown ç¬”è®°åœ¨å­æ–‡æ¡£å’Œåªè¯»æ¨¡å¼ä¸‹ä¼šæ­£ç¡®æ˜¾ç¤ºé¢„è§ˆï¼Œæä¾›äº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒå’Œæ€§èƒ½ï¼ğŸŠ
